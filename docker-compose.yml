services:
  # Single node deployment
  aipriceaction:
    build: .
    container_name: aipriceaction
    user: "${UID:-1000}:${GID:-1000}"
    ports:
      - "3000:3000"
    volumes:
      # Mount market_data directory for persistent storage
      - ./market_data:/app/market_data
      # Mount crypto_data directory for cryptocurrency data
      - ./crypto_data:/app/crypto_data
      # Mount uploads directory for user-uploaded files
      - ./uploads:/app/uploads
      # ticker_group.json and crypto_top_100.json are already copied in Dockerfile
    environment:
      - RUST_LOG=info
      - PORT=3000
      # - HTTP_PROXIES=socks5://proxy-service:1080,http://backup-proxy:8080
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Production deployment using pre-built image
  # Uncomment to use Docker Hub image instead of building locally
  # aipriceaction-prod:
  #   image: quanhua92/aipriceaction:latest
  #   platform: linux/amd64
  #   container_name: aipriceaction-prod
  #   ports:
  #     - "3000:3000"
  #   volumes:
  #     - ./market_data:/app/market_data
  #     - ./crypto_data:/app/crypto_data
  #     - ./ticker_group.json:/app/ticker_group.json:ro
  #     - ./crypto_top_100.json:/app/crypto_top_100.json:ro
  #   environment:
  #     - RUST_LOG=info
  #     - PORT=3000
  #   restart: unless-stopped
  #   healthcheck:
  #     test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
  #     interval: 30s
  #     timeout: 10s
  #     retries: 3
  #     start_period: 40s
